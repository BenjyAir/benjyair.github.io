<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="我大步走大步跑，我没有追我不会累"/>
    <meta name="keywords" content="android,github,Open Source,kokerwang"/>
    <meta name="author" content="www.kokerwang.com"/> 
    <link rel="canonical" href=""/>
    <!--<link href="http://liyouhai.com/rss.xml" title="RSS 2.0" type="application/rss+xml" rel="alternate"/>-->
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <title>Android应用内存溢出导致应用退出的解决方案 - KokerWang's blog</title>
    <link rel="stylesheet" href="/css/min/pure-min.css"/>
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/min/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/min/grids-responsive-min.css"/>
    <!--<![endif]-->

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/JekyllPure-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/JekyllPure.css"/>
    <!--<![endif]-->

    <link href="/css/min/font-awesome.min.css" rel="stylesheet"/>
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/min/font-awesome-ie7.min.css">
    <![endif]-->
    <script src="/js/min/jquery-1.7.2.min.js"></script>
</head>

<body>

<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
        <div class="header">
            <div class="headerpic">
                <a href="/">
                    <img src="/img/kokerwang.jpg" alt="Profile Picture" style="width: 140px;" title="KokerWang's blog">
                </a>
            </div>
            <h1 class="brand-title">KokerWang</h1>
            <h2 class="brand-tagline">on the way  don't weary</h2>

            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a class="pure-button" href="/timing">时间轴</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="/tag">标签库</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="/about">关于我</a>
                    </li>
                </ul>
            </nav>
            <!--<div class="search">
                <form action="/search">
                    <input type="text" class="search-query" placeholder="Search Blog" name="query" title="全站搜索-只支持英文">
                </form>
            </div>-->
            <div id="toc"></div>
            <nav id="nav">
                <ul class="nav-list">
                    <li class="nav-link">
                    <a class="weibo "  href="http://kokerwang.lofter.com/" ><i class="fa fa-weibo fa-2x"></i></a>
                    </li>
                    <li class="nav-link">
                    <a class="github" href="https://github.com/kokerwang"><i class="fa fa-github fa-2x"></i></a>
                    </li>
                    <li class="nav-link">
                    <a class="rss" href="/rss.xml" ><i class="fa fa-rss fa-2x"></i></a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <!--[if lt IE 8]>
        <i class="label label-danger">亲爱的用户，您的浏览器版本过低，建议您升级浏览器获得更好的用户体验</i>
        <![endif]-->
        <div>
            <div class="posts">

                <div class="qrcodeTable"></div>
<header class="post-header">
    <img class="post-avatar" height="48" width="48"
         src="/img/7.jpeg">

    <h2 class="post-title">Android应用内存溢出导致应用退出的解决方案</h2>

    <p class="post-meta">By 11月11日  2014  <a
            class="post-categorybut " href="/type/#">android</a><a
            class="post-category " href="/tag/#内存溢出"> 内存溢出</a><a
            class="post-category " href="/tag/#工作总结">  工作总结</a>
    </p>
</header>
<div class="article pure-u-22-24">
    <hr />

<p>昨天项目里遇到了一个严重问题,用户在使用一段时间应用之后,便会非常慢,最终导致内存溢出而崩溃,这个问题几乎让我们的一切努力白费.我几乎花了一整天的时间才终于找到了问题所在.问题的原因让我完全意料不到.</p>

<p>在分析原因的时候我使用的是 Eclipse 的 Memory AnalysisTools + DDMS,这套工具真是在关键时候救了我一命.
附上Memory Analysis插件的<a href="http://www.eclipse.org/mat/downloads.php">下载地址</a>
只使用DDMS也可以看出在activity切换过程中的内存变化,但是不能并发现问题的具体所在,所以我们需要MAT(<code>Memory AnalysisTools</code>)来分析具体是那个类引发的问题.上图</p>

<p><img src="/img/20141111211142.png" alt="tool-editor" /></p>

<p>上图大家应该都看的懂吧,不懂的我简单说一下,也不要嫌弃我啰嗦:</p>

<blockquote><ul>
<li>1位置是开始监控 一般在启动应用之后就可以点上来查看记录了</li>
<li>2位置是保存分析到文件,装了Memory Analysis之后便可以直接打开分析界面</li>
<li>3位置是查看内存数值的区域，内存变化的过程基本上就是在这里分析出来的</li>
</ul>
</blockquote>

<p>具体的使用大家可以参考这篇文章<a href="http://www.360doc.com/content/12/1023/14/203871_243274421.shtml">http://www.360doc.com/content/12/1023/14/203871_243274421.shtml</a>,解决问题的过程真的是非常的快乐的,我希望大家也可以通过这个过程get新技能,而不是一味的copy.</p>

<p>分析的过程我也就不多说了 好多次的分析才找到了问题所在,依然直接说结果:</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;现在大家在写app的时候通常会使用一个集合来保存整个activity.或放在BaseActivity里,或放在Application里,
然后在退出应用的时候遍历集合逐个调用finish方法,以此来达到退出整个应用,这些方法在网上很多写法,也是大多数人推荐的做法,但我如今碰到的问题就是这里导致的.我的测试结果是,虽然在每个activity的finish方法里把自己从容器里移除自己,但依然因为这个导致activity不能释放,如此循环往复导致了内存溢出.找到了问题所在就好解决多了,就怕有问题自己也摸不到头绪.其实如果自己控制好每个界面的启动和销毁,这样的做法完全是多此一举的,如果你实在想这样做,推荐的是使用广播的方法,在每个activity里面注册一个广播,应用退出的时候通过广播来关闭所有activity,不要忘了在onDestroy里注销广播哟,</p>

<p>ps:
我曾经也深信不疑的使用网上的各种现成的代码,但如今,我想至少应该测试过会再使用才行,不要人云亦云,知其然知其所以然,才能最大的提升自己的能力.感谢项目经理的耐心教导。
另外<strong>MAT</strong>工具推荐大家都学习一下,特别是大型项目一定要严格控制内存,否则会死的很惨.</p>

<hr />

</div>
    <div class="pure-g pagination">
        
        <a class="pure-u-1-2 pagination-item " href="/android/%E5%85%B3%E4%BA%8E%E4%BD%BF%E7%94%A8commons-codec.jar%E5%87%BA%E7%8E%B0%E6%96%B9%E6%B3%95%E6%89%BE%E4%B8%8D%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98.html" title="关于使用commons-codec.jar出现方法找不到的问题 "><p> <i class="fa fa-mail-reply"></i>&nbsp;关于使用commons-codec.jar出现方法找不到的问题</p></a>
        
        
        <a class="pure-u-1-2 pagination-item " href="/android/%E5%85%B3%E4%BA%8EWebView%E5%9B%A0url%E9%87%8D%E5%AE%9A%E5%90%91%E8%80%8C%E5%AF%BC%E8%87%B4%E6%97%A0%E6%B3%95goBack%E7%9A%84%E9%97%AE%E9%A2%98.html" title="关于WebView因url重定向而导致无法goBack的问题"><p>关于WebView因url重定向而导致无法goBack的问题&nbsp;<i class="fa fa-mail-forward"></i></p></a>
        
    </div>
    <link href="/css/code.css" rel="stylesheet">
    <link href="/css/min/fancybox.css" rel="stylesheet">
    <script src="/js/min/jquery.toc.min.js" ></script>
    <script src="/js/min/jquery.qrcode.min.js" ></script>
    <script src="/js/min/jquery.fancybox.pack.js" ></script>
    <!--<script src="/js/page.js" ></script>-->

    
    

    
    






            </div>
            </div>
           
        <div class="footer" style="float:left" >
                <a href="/about">About</a>
                <a href="http://kokerwang.lofter.com/">LOFTER</a>
                <a href="tencent://message/?uin=280995163">QQ</a>
                <a href="https://github.com/kokerwang">GitHub</a>
                <a href="http://www.kokerwang.com">Powered by KokerWang</a>
                <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253336121'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1253336121%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
            <script src="/js/min/nprogress.min.js"></script>
            <script src="/js/index.js"></script>
        </div>
        <div class="topfade"><a href="javascript:;" title="返回顶部"></a></div>
    </div>
</div>
</body>
</html>
