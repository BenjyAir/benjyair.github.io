<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="我大步走大步跑，我没有追我不会累"/>
    <meta name="keywords" content="android,github,Open Source,kokerwang"/>
    <meta name="author" content="www.kokerwang.com"/> 
    <link rel="canonical" href=""/>
    <!--<link href="http://liyouhai.com/rss.xml" title="RSS 2.0" type="application/rss+xml" rel="alternate"/>-->
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <title>为Context-Menu.Android库增加用户体验 - KokerWang's blog</title>
    <link rel="stylesheet" href="/css/min/pure-min.css"/>
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/min/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/min/grids-responsive-min.css"/>
    <!--<![endif]-->

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/JekyllPure-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/JekyllPure.css"/>
    <!--<![endif]-->

    <link href="/css/min/font-awesome.min.css" rel="stylesheet"/>
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/min/font-awesome-ie7.min.css">
    <![endif]-->
    <script src="/js/min/jquery-1.7.2.min.js"></script>
</head>

<body>

<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
        <div class="header">
            <div class="headerpic">
                <a href="/">
                    <img src="/img/kokerwang.jpg" alt="Profile Picture" style="width: 140px;" title="KokerWang's blog">
                </a>
            </div>
            <h1 class="brand-title">KokerWang</h1>
            <h2 class="brand-tagline">on the way  don't weary</h2>

            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a class="pure-button" href="/timing">时间轴</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="/tag">标签库</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="/about">关于我</a>
                    </li>
                </ul>
            </nav>
            <!--<div class="search">
                <form action="/search">
                    <input type="text" class="search-query" placeholder="Search Blog" name="query" title="全站搜索-只支持英文">
                </form>
            </div>-->
            <div id="toc"></div>
            <nav id="nav">
                <ul class="nav-list">
                    <li class="nav-link">
                    <a class="weibo "  href="http://kokerwang.lofter.com/" ><i class="fa fa-weibo fa-2x"></i></a>
                    </li>
                    <li class="nav-link">
                    <a class="github" href="https://github.com/kokerwang"><i class="fa fa-github fa-2x"></i></a>
                    </li>
                    <li class="nav-link">
                    <a class="rss" href="/rss.xml" ><i class="fa fa-rss fa-2x"></i></a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <!--[if lt IE 8]>
        <i class="label label-danger">亲爱的用户，您的浏览器版本过低，建议您升级浏览器获得更好的用户体验</i>
        <![endif]-->
        <div>
            <div class="posts">

                <div class="qrcodeTable"></div>
<header class="post-header">
    <img class="post-avatar" height="48" width="48"
         src="/img/10.jpeg">

    <h2 class="post-title">为Context-Menu.Android库增加用户体验</h2>

    <p class="post-meta">By 01月25日  2015  <a
            class="post-categorybut " href="/type/#">android</a><a
            class="post-category " href="/tag/#开源库"> 开源库</a><a
            class="post-category " href="/tag/#工作总结">  工作总结</a>
    </p>
</header>
<div class="article pure-u-22-24">
    <hr />

<h2>序：</h2>

<p><code>Github上面有很多的开源库，除了工具库之外，还有大量的UI库供我们使用，在使用这些UI库的时候开源者本人可能会给我们一些可以自定义的功能，可是在某种情况下，我们还需要对一些作者没有开放的功能进行定制，那我们就只能通过修改源码的方式来实现了，今天我介绍一下我对开源项目Context-Menu.Android的部分定制过程</code></p>

<h2>介绍</h2>

<p><a href="https://github.com/Yalantis/Context-Menu.Android">Context-Menu.Android</a>是由<code>Yalantis</code>开源的一个上下文菜单的UI库，如下图，非常的酷炫。</p>

<p><img src="https://d13yacurqjgara.cloudfront.net/users/125056/screenshots/1785274/99miles-profile-light_1-1-4.gif" alt="ContextMenu" /></p>

<p>使用起来也非常的简单，具体使用大家可以在Github上看作者的使用介绍，我在这里就不在赘述。</p>

<h2>问题</h2>

<p>在使用这个库的时候，我遇到了如下问题：</p>

<blockquote><ul>
<li>当菜单打开的时候点击旁边灰色的部分该菜单Menu不能消失，只能点击任意一个Item 或者点击返回键才能让其隐藏，那么我认为这样的体验是不好的。</li>
</ul>
</blockquote>

<h2>解决</h2>

<p>思路：给灰色背景布局加一个点击事件，该事件的处理就是Menu的点击处理，只不过不调用item的回调方法，有了思路，那么找起来就简单的多了。</p>

<blockquote><ul>
<li>首先我们需要找到完成点击动画的代码。打开<code>ContextMenuDialogFragment.java</code>我们可以轻易找到点击事件是在实现了<code>MenuAdapter.OnItemClickListener</code>接口的<code>onClick</code>方法中。那么我们进入<code>MenuAdapter.java</code>，在这里我们终于找到了点击事件的代码。
<img src="/img/20150125161035.png" alt="tool-editor" />
从代码中可以看出，只要我们给灰色的布局加上一个这个事件调用该方法就能达到我们的目的。</li>
<li><p>其次我们需要找到灰色的布局组件。接下来进入该Fragment 的布局文件<code>fragment_menu.xml</code>在这里我们发现了背景其实就是一个RelativeLayout，那事情就好办多了，给这个RelativeLayout加上id，在ContextMenuDialogFragment的<code>initViews</code>方法中初始化一下该组件
<img src="/img/20150125161418.png" alt="tool-editor" /></p></li>
<li><p>最后 给<code>RelativeLayout</code>加上<code>OnClickListener</code>事件,然后调用之前关闭动画的那个方法。我的做法是直接给MenuAdapter新增加一个dismissMenu方法，去除无用的代码并指定默认点击的是第一个组件，因为出现的动画是由第一个Item开始的，所以这里把默认的执行动画由第一个来结束也最合理，代码如下
<img src="/img/20150125161919.png" alt="tool-editor" />
<img src="/img/20150125162038.png" alt="tool-editor" /></p></li>
</ul>
</blockquote>

<p>测试一下，大功告成</p>

<h2>遗留问题</h2>

<p>点击手机返回键的时候Menu是直接消失的，并没有执行结束动画，由于Fragment没有OnKeyDown方法，并且该组件继承自DialogFragment，我在使尝试了几种办法之后最终无果，只好暂时放弃。等以后有时间再解决这个问题</p>

<p>项目的话由于涉及到开源协议，而我又不想弄分支所以就不发布修改版的库了，不过看上面的介绍大家也足可以做到我说的效果，还能帮助大家理解这个库，何乐而不为。如果实在有困难你可以联系我。</p>

</div>
    <div class="pure-g pagination">
        
        <a class="pure-u-1-2 pagination-item " href="/android/%E4%BB%8EFramework%E5%B1%82%E7%9C%8BAndroid%E5%90%AF%E5%8A%A8.html" title="从Framework层看Android启动 "><p> <i class="fa fa-mail-reply"></i>&nbsp;从Framework层看Android启动</p></a>
        
        
        <span class="pure-u-1-2 pagination-item "><p>下一篇&nbsp;<i class="fa fa-chain-broken"></i></p></span>
        
    </div>
    <link href="/css/code.css" rel="stylesheet">
    <link href="/css/min/fancybox.css" rel="stylesheet">
    <script src="/js/min/jquery.toc.min.js" ></script>
    <script src="/js/min/jquery.qrcode.min.js" ></script>
    <script src="/js/min/jquery.fancybox.pack.js" ></script>
    <!--<script src="/js/page.js" ></script>-->

    
    

    
    






            </div>
            </div>
           
        <div class="footer" style="float:left" >
                <a href="/about">About</a>
                <a href="http://kokerwang.lofter.com/">LOFTER</a>
                <a href="tencent://message/?uin=280995163">QQ</a>
                <a href="https://github.com/kokerwang">GitHub</a>
                <a href="http://www.kokerwang.com">Powered by KokerWang</a>
                <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253336121'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1253336121%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
            <script src="/js/min/nprogress.min.js"></script>
            <script src="/js/index.js"></script>
        </div>
        <div class="topfade"><a href="javascript:;" title="返回顶部"></a></div>
    </div>
</div>
</body>
</html>
