<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="我大步走大步跑，我没有追我不会累"/>
    <meta name="keywords" content="android,github,Open Source,kokerwang"/>
    <meta name="author" content="www.kokerwang.com"/> 
    <link rel="canonical" href=""/>
    <!--<link href="http://liyouhai.com/rss.xml" title="RSS 2.0" type="application/rss+xml" rel="alternate"/>-->
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon"/>
    <title>解决Android因重定向而导致WebView无法goBack的问题 - KokerWang's blog</title>
    <link rel="stylesheet" href="/css/min/pure-min.css"/>
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/min/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/min/grids-responsive-min.css"/>
    <!--<![endif]-->

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/JekyllPure-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/JekyllPure.css"/>
    <!--<![endif]-->

    <link href="/css/min/font-awesome.min.css" rel="stylesheet"/>
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/min/font-awesome-ie7.min.css">
    <![endif]-->
    <script src="/js/min/jquery-1.7.2.min.js"></script>
</head>

<body>

<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
        <div class="header">
            <div class="headerpic">
                <a href="/">
                    <img src="/img/kokerwang.jpg" alt="Profile Picture" style="width: 140px;" title="KokerWang's blog">
                </a>
            </div>
            <h1 class="brand-title">KokerWang</h1>
            <h2 class="brand-tagline">on the way  don't weary</h2>

            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a class="pure-button" href="/timing">时间轴</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="/tag">标签库</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="/about">关于我</a>
                    </li>
                </ul>
            </nav>
            <!--<div class="search">
                <form action="/search">
                    <input type="text" class="search-query" placeholder="Search Blog" name="query" title="全站搜索-只支持英文">
                </form>
            </div>-->
            <div id="toc"></div>
            <nav id="nav">
                <ul class="nav-list">
                    <li class="nav-link">
                    <a class="weibo "  href="http://kokerwang.lofter.com/" ><i class="fa fa-weibo fa-2x"></i></a>
                    </li>
                    <li class="nav-link">
                    <a class="github" href="https://github.com/kokerwang"><i class="fa fa-github fa-2x"></i></a>
                    </li>
                    <li class="nav-link">
                    <a class="rss" href="/rss.xml" ><i class="fa fa-rss fa-2x"></i></a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <!--[if lt IE 8]>
        <i class="label label-danger">亲爱的用户，您的浏览器版本过低，建议您升级浏览器获得更好的用户体验</i>
        <![endif]-->
        <div>
            <div class="posts">

                <div class="qrcodeTable"></div>
<header class="post-header">
    <img class="post-avatar" height="48" width="48"
         src="/img/8.jpeg">

    <h2 class="post-title">解决Android因重定向而导致WebView无法goBack的问题</h2>

    <p class="post-meta">By 11月16日  2014  <a
            class="post-categorybut " href="/type/#">android</a><a
            class="post-category " href="/tag/#WebView"> WebView</a><a
            class="post-category " href="/tag/#工作总结">  工作总结</a>
    </p>
</header>
<div class="article pure-u-22-24">
    <hr />

<p>最近项目中有一些界面需要嵌入wap页，在按返回键的时候让WebView goBack, 大部分界面都是可以正常回退的,可是某些会重定向的地址却无法正常goBack,原因是,退回重定向之前的url又被重定向了回来,网上的解决办法是自己控制一个url集合,我试了一下非常麻烦,因为我们还需要goForward 功能,仅仅使用一个LinkedList还满足不了需求.最终还是放弃了这样的做法,后来终于在<code>stackOverflow</code> 上找到了解决的办法,解决的方法真是格外的简单.直接看代码</p>

<p>为了让WebView控制界面里面的url跳转,我们一般都会设置<code>WebViewClient</code> ，并重写shouldOverrideUrlLoading方法，让webView加载点击url,一般的例子代码如下:</p>

<pre><code class="java">webView.setWebViewClient(new WebViewClient() {

    @Override
    public boolean shouldOverrideUrlLoading(WebView view, String url) {
         view.loadUrl(url);
        return true;
    }
});
</code></pre>

<p>解决办法:</p>

<pre><code class="java">webView.setWebViewClient(new WebViewClient() {

    @Override
    public boolean shouldOverrideUrlLoading(WebView view, String url) {

        return false;
    }
});
</code></pre>

<p>万万没想到解决办法就在 api 里面,shouldOverrideUrlLoading这个方法的 api 如下:</p>

<p>Give the host application a chance to take over the control when a new url is about to be loaded in the current WebView. If WebViewClient is not provided, by default WebView will ask Activity Manager to choose the proper handler for the url. If WebViewClient is provided, return true means the host application handles the url, while return false means the current WebView handles the url.</p>

<p>就是说如果application处理这个url则返回<code>true</code>,如果WebView处理这个url则返回<code>false</code>.我们让WebView处理了这个url就应该返回<code>false</code>,否则相当于处理的两(多)次,而这也是这个问题出现的原因所在.</p>

<p>后来我又看了一下<code>WebViewClient</code>的其他方法发现原来好多问题都可以在这里解决,只是之前用的不多不知道有这些方法,例如:</p>

<blockquote><ul>
<li>onPageStarted 在页面加载开始时调用.</li>
<li>onPageFinished 在页面加载结束时调用.</li>
<li>onLoadResource 在加载页面资源时会调用，每一个资源（比如图片）的加载都会调用一次.</li>
</ul>
</blockquote>

<p>如果你还需要更丰富的处理效果那么推荐你用<code>WebChromeClient</code>.</p>

<p>ps: 最近国内github好不稳定啊，这让我们怎么活</p>

<hr />

</div>
    <div class="pure-g pagination">
        
        <a class="pure-u-1-2 pagination-item " href="/android/Android%E5%BA%94%E7%94%A8%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E5%AF%BC%E8%87%B4%E5%BA%94%E7%94%A8%E9%80%80%E5%87%BA%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html" title="Android应用内存溢出导致应用退出的解决方案 "><p> <i class="fa fa-mail-reply"></i>&nbsp;Android应用内存溢出导致应用退出的解决方案</p></a>
        
        
        <span class="pure-u-1-2 pagination-item "><p>下一篇&nbsp;<i class="fa fa-chain-broken"></i></p></span>
        
    </div>
    <link href="/css/code.css" rel="stylesheet">
    <link href="/css/min/fancybox.css" rel="stylesheet">
    <script src="/js/min/jquery.toc.min.js" ></script>
    <script src="/js/min/jquery.qrcode.min.js" ></script>
    <script src="/js/min/jquery.fancybox.pack.js" ></script>
    <!--<script src="/js/page.js" ></script>-->

    
    

    
    






            </div>
            </div>
           
        <div class="footer" style="float:left" >
                <a href="/about">About</a>
                <a href="http://kokerwang.lofter.com/">LOFTER</a>
                <a href="tencent://message/?uin=280995163">QQ</a>
                <a href="https://github.com/kokerwang">GitHub</a>
                <a href="http://www.kokerwang.com">Powered by KokerWang</a>
                <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253336121'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1253336121%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
            <script src="/js/min/nprogress.min.js"></script>
            <script src="/js/index.js"></script>
        </div>
        <div class="topfade"><a href="javascript:;" title="返回顶部"></a></div>
    </div>
</div>
</body>
</html>
